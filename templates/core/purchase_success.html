{% extends "base.html" %}
{% load static %}

{% block title %}{% if success %}Payment Successful{% else %}Payment Status{% endif %} - Xanula{% endblock %}

{% block content %}
<div class="container py-12 max-w-lg mx-auto text-center">
    {% if success or already_processed %}
    <!-- Success State -->
    <div class="mb-8">
        <div class="w-20 h-20 bg-forest-100 dark:bg-forest-900/30 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg class="w-10 h-10 text-forest-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
        </div>
        <h1 class="font-display text-3xl font-bold text-gray-900 dark:text-white mb-2">Payment Successful!</h1>
        <p class="text-gray-600 dark:text-gray-400">Thank you for your purchase</p>
    </div>

    <!-- Purchase Details -->
    <div class="bg-white dark:bg-dark-100 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 mb-8">
        <div class="flex items-center gap-4 mb-6 pb-4 border-b border-gray-100 dark:border-gray-700">
            <div class="w-14 h-20 flex-shrink-0 rounded-lg overflow-hidden shadow">
                {% if book.cover_image %}
                <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="w-full h-full object-cover">
                {% else %}
                <div class="w-full h-full bg-gradient-to-br from-burgundy-500 to-forest-500 flex items-center justify-center">
                    <span class="font-display font-bold text-white/40">{{ book.title|first }}</span>
                </div>
                {% endif %}
            </div>
            <div class="text-left">
                <h3 class="font-display font-semibold text-gray-900 dark:text-white">{{ book.title }}</h3>
                <p class="text-sm text-gray-500">by {{ book.author.get_full_name }}</p>
            </div>
        </div>

        <div class="space-y-3 text-sm">
            <div class="flex justify-between">
                <span class="text-gray-500">Amount Paid</span>
                <span class="font-medium text-gray-900 dark:text-white">
                    {% if purchase.amount_paid == 0 %}Free{% else %}{{ purchase.amount_paid|floatformat:0 }} XAF{% endif %}
                </span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-500">Payment Method</span>
                <span class="font-medium text-gray-900 dark:text-white">{{ purchase.get_payment_method_display }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-500">Transaction ID</span>
                <span class="font-mono text-xs text-gray-600 dark:text-gray-400">{{ purchase.payment_transaction_id|truncatechars:20 }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-500">Date</span>
                <span class="font-medium text-gray-900 dark:text-white">{{ purchase.purchase_date|date:"M d, Y" }}</span>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="space-y-3">
        <a href="{% url 'core:library' %}" class="btn btn-primary btn-lg btn-block">Go to My Library</a>
        <a href="{% url 'core:book_list' %}" class="btn btn-secondary btn-block">Continue Shopping</a>
    </div>

    <p class="text-sm text-gray-500 mt-6">ðŸ“§ A receipt has been sent to your email</p>

    {% else %}
    <!-- Error State -->
    <div class="mb-8">
        <div class="w-20 h-20 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </div>
        <h1 class="font-display text-3xl font-bold text-gray-900 dark:text-white mb-2">Payment Issue</h1>
        <p class="text-gray-600 dark:text-gray-400">{{ error_message|default:"There was a problem with your payment." }}</p>
    </div>

    <!-- Book Info -->
    <div class="bg-white dark:bg-dark-100 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 mb-8">
        <div class="flex items-center gap-4">
            <div class="w-14 h-20 flex-shrink-0 rounded-lg overflow-hidden shadow">
                {% if book.cover_image %}
                <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="w-full h-full object-cover">
                {% else %}
                <div class="w-full h-full bg-gradient-to-br from-burgundy-500 to-forest-500"></div>
                {% endif %}
            </div>
            <div class="text-left">
                <h3 class="font-display font-semibold text-gray-900 dark:text-white">{{ book.title }}</h3>
                <p class="text-sm text-burgundy-500 font-medium">{{ book.formatted_price }}</p>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="space-y-3">
        <a href="{% url 'core:initiate_purchase' slug=book.slug %}" class="btn btn-primary btn-lg btn-block">Try Again</a>
        <a href="{{ book.get_absolute_url }}" class="btn btn-secondary btn-block">Back to Book</a>
    </div>

    <p class="text-sm text-gray-500 mt-6">
        If you were charged, please <a href="mailto:support@xanula.com" class="text-burgundy-500 hover:underline">contact support</a>
    </p>
    {% endif %}
</div>
{% endblock %}
